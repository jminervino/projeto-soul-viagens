<div class="feed">
  <!-- Tabs -->
  <div class="feed__tabs">
    <button
      class="feed__tab"
      [class.feed__tab--active]="activeTab === 'todos'"
      (click)="setActiveTab('todos')">
      Todos
    </button>
    <button
      class="feed__tab"
      [class.feed__tab--active]="activeTab === 'meus'"
      (click)="setActiveTab('meus')">
      Meus Diários
    </button>
  </div>

  <!-- Tab: Todos -->
  <div class="feed__content" *ngIf="activeTab === 'todos'">
    <div *ngIf="allDiarios$ | async as diarios; else loading" class="feed__list">
      <article
        class="card"
        *ngFor="let diario of diarios | paginate: { itemsPerPage: 6, currentPage: pagina }">
        <!-- Card Header -->
        <div class="card__header">
          <div class="card__avatar"></div>
          <div class="card__author">
            <span class="card__name">{{ diario.usuarioName }}</span>
            <span class="card__nick">{{ diario.usuarioNick }}</span>
          </div>
        </div>

        <!-- Card Image -->
        <div class="card__image-wrap" (click)="onClickView(diario)">
          <img class="card__image" [src]="diario.imagem" [alt]="diario.titulo" loading="lazy" />
        </div>

        <!-- Card Body -->
        <div class="card__body">
          <h3 class="card__title">{{ diario.titulo }}</h3>
          <div class="card__meta">
            <span>{{ diario.data | date:'dd MMM yyyy' }}</span>
            <span class="card__meta-dot"></span>
            <span>{{ diario.local }}</span>
          </div>
          <p class="card__text">{{ diario.corpo }}</p>
        </div>

        <!-- Card Footer -->
        <div class="card__footer">
          <button
            class="card__action"
            (click)="onClickView(diario)"
            matTooltip="Ver detalhes"
            aria-label="Ver detalhes">
            <mat-icon>open_in_full</mat-icon>
          </button>
        </div>
      </article>

      <div class="feed__pagination">
        <pagination-controls
          [responsive]="true"
          previousLabel="Anterior"
          nextLabel="Próximo"
          [maxSize]="5"
          (pageChange)="pagina = $event">
        </pagination-controls>
      </div>
    </div>
  </div>

  <!-- Tab: Meus Diários -->
  <div class="feed__content" *ngIf="activeTab === 'meus'">
    <div *ngIf="meusDiarios$ | async as diarios; else loading">
      <div class="gallery" *ngIf="diarios.length; else empty">
        <div class="gallery__card" *ngFor="let diario of diarios" (click)="onClickView(diario)">
          <img class="gallery__card-img" [src]="diario.imagem" [alt]="diario.titulo" loading="lazy" />
          <div class="gallery__card-overlay">
            <span class="gallery__card-title">{{ diario.titulo }}</span>
            <div class="gallery__card-actions" (click)="$event.stopPropagation()">
              <button
                mat-icon-button
                (click)="onClickEdit(diario)"
                matTooltip="Editar"
                aria-label="Editar diário">
                <mat-icon>edit</mat-icon>
              </button>
              <button
                mat-icon-button
                (click)="onClickDelete(diario)"
                matTooltip="Excluir"
                aria-label="Excluir diário">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>
        </div>
      </div>
      <ng-template #empty>
        <div class="feed__empty">
          <mat-icon class="feed__empty-icon">auto_stories</mat-icon>
          <p>Você ainda não criou nenhum diário.</p>
          <button mat-raised-button color="primary" (click)="onClickAdd()" class="feed__empty-btn">
            Criar primeiro diário
          </button>
        </div>
      </ng-template>
    </div>
  </div>
</div>

<ng-template #loading>
  <app-loader label="Carregando diários..."></app-loader>
</ng-template>

<!-- FAB -->
<div class="fab">
  <button (click)="onClickAdd()" mat-fab color="primary" matTooltip="Adicionar diário" class="fab__btn">
    <mat-icon>add</mat-icon>
  </button>
</div>
